window.googletag=window.googletag||{cmd:[]};window.pbjs=window.pbjs||{que:[]};window.apstag=window.apstag||{init:function(){this._Q.push(["i",arguments])},fetchBids:function(){this._Q.push(["f",arguments])},setDisplayBids:function(){},targetingKeys:function(){return[]},_Q:[]};var ramjs=ramjs||{};ramjs.business={_prebidProperties:["code","mediaTypes","bids"],_adSlots:[],_abp:typeof(abp)!="undefined"&&abp,init:function(a){ramjs.config.logInfo("ramjs.business.init: start");ramjs.config.logInfo("ramjs.business.init: ABP detected:",this._abp);var d=a.concat([]);if(this.shouldDisplayInterstitialSlot()){ramjs.config.logInfo("ramjs.business.init: added 'interstitial' to be initialized, if any");d=d.concat(["interstitial"])}var b=this.getAdSetupByTags(d);googletag.cmd.push(function(){ramjs.business.addGoogletagSlots(b);googletag.pubads().enableSingleRequest();googletag.enableServices();ramjs.config.logInfo("GPT: Call to enableServices().")});var c=this.getPrebidAdUnits(b);ramjs.prebid.init(c);ramjs.aps.init();ramjs.signal.init();ramjs.pubstack.init();ramjs.config.logInfo("ramjs.business.init: end")},_loadScript:function(){ramjs.config.logInfo("Initializing GAM script...");if(typeof(adblock)!="undefined"){var a=document.createElement("script");a.type="text/javascript";a.src="https://securepubads.g.doubleclick.net/tag/js/gpt.js";a.defer=true;document.head.appendChild(a)}},run:function(){this._loadScript();ramjs.business.processQueue()},processQueue:function(){var b=ramjs.que.slice();ramjs.que=[];ramjs.que.push=function(c){ramjs.business._processQueueElement(c)};if(b.length>0){for(var a in b){ramjs.business._processQueueElement(b[a])}}},_processQueueElement:function(a){elementType=typeof(a);if(elementType==="function"){try{a.call()}catch(b){ramjs.config.logError("Error processing function :",b.message,b.stack)}}else{if(elementType==="object"){try{ramjs.business.refreshAdsByTags(a)}catch(b){ramjs.config.logError("Error processing array :",b.message,b.stack)}}else{ramjs.config.logError("Elements written into ramjs.que must be a wrapping function or an array object with strings")}}},refreshAdsByTags:function(a){if(this._abp){ramjs.config.logInfo("ramjs.business.refreshAdsByTags: abp detected. ads won't be refreshed in this case. Tags:",a);return}if(ramjs.business._shouldDisplayAds()&&typeof ramjs.business._adSlots!=="undefined"&&ramjs.business._adSlots.length>0){var c=this.getAdsByType(a);if(c.noBidAds.length>0){var b=this.getAdUnitsCode(c.noBidAds);ramjs.config.logInfo("ramjs.business.refreshAdsByTags: ads without auction:",b);googletag.cmd.push(function(){ramjs.business.setParamsForGPTAsync();var d=ramjs.business.getGoogleSlotsFromAdCode(ramjs.business._adSlots,b)||[];if(d.length>0){googletag.pubads().refresh(d,{changeCorrelator:false})}else{ramjs.config.logWarn("ramjs.business.refreshAdsByTags: no ads to refresh:",d)}})}if(c.bidAds.length>0){var b=this.getAdUnitsCode(c.bidAds);this.runAuction(b)}}else{if(typeof(adblock)!="undefined"){setTimeout(function(){ramjs.business.refreshAdsByTags(a)},500)}}},setParamsForGPTAsync:function(){ramjs.business.setConsentStatusGPTTargeting()},_shouldDisplayAds:function(){var a=false;if(rumjs.didomi){a=rumjs.didomi.getUserPurpose1ConsentStatus("google")}return a},setConsentStatusGPTTargeting:function(){key="consent-status";value="n/a";if(rumjs.didomi){value=rumjs.didomi.getDidomiStatus()}else{ramjs.config.logWarn("setConsentStatusGPTTargeting - CMP not set")}if(key&&value){googletag.pubads().clearTargeting(key.toString());googletag.pubads().setTargeting(key.toString(),value.toString());ramjs.config.logInfo("setConsentStatusGPTTargeting:",key,"-",value)}else{ramjs.config.logError("setConsentStatusGPTTargeting: Error while setting GPT targeting. Key or value are undefined or null. Key:",key,"- Value:",value)}},runAuction:function(a){if(a.length<=0){return}a=[].concat.apply([],a);ramjs.config.logInfo("ramjs.business.runAuction: start. Ads with auction:",a);var b=this._prepareNewAuction(a);ramjs.prebid.requestBids(a,function(c){ramjs.config.logInfo("ramjs.business.runAuction: prebid bidBackHandler call");ramjs.prebid._winningBids();googletag.cmd.push(function(){ramjs.prebid.setTargetingForGPTAsync(a);ramjs.business._auctionRequestManager[b].prebid=true;ramjs.business.biddersBackHandler(a,b)})});if(ramjs.aps._enabled){ramjs.aps.requestBids(a,function(c){ramjs.config.logInfo("ramjs.business.runAuction: aps bidBackHandler call");ramjs.aps._winningBids(c);googletag.cmd.push(function(){apstag.setDisplayBids();ramjs.business._auctionRequestManager[b].aps=true;ramjs.business.biddersBackHandler(a,b)})})}else{ramjs.business._auctionRequestManager[b].aps=true}},_auctionRequestManager:{},_prepareNewAuction:function(a){var b=Math.random().toString(36).substring(2)+"-"+new Date().getTime();this._auctionRequestManager[b]={adserverRequestSent:false,aps:false,prebid:false};return b},biddersBackHandler:function(a,b){if(this._auctionRequestManager[b].aps&&this._auctionRequestManager[b].prebid){this.sendAdServerRequest(a,b)}return},sendAdServerRequest:function(a,b){if(this._auctionRequestManager[b].adserverRequestSent===true){return}this._auctionRequestManager[b].adserverRequestSent=true;googletag.cmd.push(function(){ramjs.business.setParamsForGPTAsync();ramjs.config.logInfo("ramjs.business.sendAdServerRequest: Ads to refresh:",a);var c=ramjs.business.getGoogleSlotsFromAdCode(ramjs.business._adSlots,a)||[];googletag.pubads().refresh(c,{changeCorrelator:false})})},getPrebidAdUnits:function(b){var a=[];for(var e in b){var d=b[e];if(d.tags.indexOf("nobid")===-1){ad_unit={};for(var c in this._prebidProperties){var f=this._prebidProperties[c];if(b[e].hasOwnProperty(f)){ad_unit[f]=b[e][f]}}ad_unit=ramjs.pubstack.addAdUnitPath(d,ad_unit);a.push(ad_unit)}}return a},getAdSetupByTags:function(b){var d=[],e=ramjs.config.adUnits;for(var c in e){for(var a in b){if(typeof(a)==="string"&&e[c].hasOwnProperty("tags")&&e[c]["tags"].indexOf(b[a])!==-1){d.push(e[c]);break}}}return d},getAdsByType:function(b){var d=this.getAdSetupByTags(b);var e=[],a=[];for(var c in d){if((d[c].hasOwnProperty("tags")&&d[c]["tags"].indexOf("nobid")!==-1)){e.push(d[c])}else{a.push(d[c])}}return{noBidAds:e,bidAds:a}},getAdUnitsCode:function(a){return a.map(function(b){return b.code})},defineGoogletagSlots:function(a){var c=[];var d=[];for(var b in a){n=a[b];slotname=n.name;if(n.hasOwnProperty("slotname")){slotname=n.slotname}ramjs.config.logInfo("Defining Google slot with name:",n.code);var e;if(ramjs.config.interstitial&&ramjs.config.interstitial.type==="google"&&n.hasOwnProperty("tags")&&n.tags.indexOf("interstitial")!==-1){ramjs.config.logInfo("Google interstitial slot to create:",n.code);e=googletag.defineOutOfPageSlot("/"+ramjs.config.siteID+"/"+slotname,googletag.enums.OutOfPageFormat.INTERSTITIAL);d.push(n);ramjs.config.logInfo("Google interstitial slot created:",n.code)}else{e=googletag.defineSlot("/"+ramjs.config.siteID+"/"+slotname,n.mediaTypes.banner.sizes,n.code);if(n.hasOwnProperty("responsiveSizeMapping")){e.defineSizeMapping(n.responsiveSizeMapping);ramjs.config.logInfo("Defining Google slot",n.code,"with responsive sizes:",n.responsiveSizeMapping)}}if(e){c.push({code:n.code,gptslot:e.addService(googletag.pubads())});ramjs.config.logInfo("New Google slot defined:",n.code)}else{ramjs.config.logInfo("Google slot is not defined. googletag returned null while defining. Ignoring:",n.code)}}if(d.length>0){ramjs.business.displayInterstitialSlot(d)}return c},displayGoogletagSlot:function(a){if(typeof(adblock)!="undefined"){googletag.cmd.push(function(){ramjs.config.logInfo("Google slot to display:",a);googletag.display(a)})}},getGoogleSlotsFromAdCode:function(b,c){var a=Array.isArray(c)?c:[c];return b.filter(function(d){return a.indexOf(d.code)>=0}).map(function(d){ramjs.config.logInfo("Google slot selected:",d);return d.gptslot})},addGoogletagSlots:function(a){ramjs.config.logInfo("addGoogletagSlots: adding new google slots for:",a);var b=ramjs.business._adSlots.concat([]);b=b.concat(ramjs.business.defineGoogletagSlots(a));if(b.length>0){ramjs.business._adSlots=b}},_shouldAddGoogletagEventListener:true,addGoogletagAdEventListener:function(a,b){if(this._shouldAddGoogletagEventListener){this._shouldAddGoogletagEventListener=false;if(ramjs.config.interstitial){ramjs.config.logInfo("Interstitial slot - added event to display interstitial slots after DOM content is loaded. Slots:",a);googletag.cmd.push(function(){var c=ramjs.config.interstitial.googleTagEvent?ramjs.config.interstitial.googleTagEvent:"impressionViewable";googletag.pubads().addEventListener(c,function(g){var d=g.slot.getAdUnitPath();for(var e in a){var f=a[e];if(d==="/"+ramjs.config.siteID+"/"+f.name){ramjs.config.logInfo("Interstitial slot displayed:",f.name,"-",d,"- minimum timespan to see next interstitial:",ramjs.config.interstitial.displayedCookieTimeExpiration,"in domain:",ramjs.config.interstitial.displayedCookieDomain);ramjs.config.setCookie(ramjs.config.interstitial.displayedCookieName,1,{path:"/",expires:ramjs.config.interstitial.displayedCookieTimeExpiration,domain:ramjs.config.interstitial.displayedCookieDomain});if(b){b()}}}})})}}},displayInterstitialSlot:function(d,g,e){if(d.length===0){ramjs.config.logInfo("No interstitial slots to display.");return}this.addGoogletagAdEventListener(d,g);for(var b in d){var f=d[b];if(f.hasOwnProperty("tags")&&f.tags.indexOf("interstitial")===-1){ramjs.config.logWarn("Slot does not contain tag 'interstitial'. We will not create the slot. Are you sure you selected the right ad unit? Selected:",f.slotname,f);continue}ramjs.config.logInfo("Interstitial slot to display:",f.name);if(e===true){var a=this.getAdUnitsCode(this._adSlots);if(a.indexOf(f.code)===-1){var c=this.getAdSetupByTags(["interstitial"]);googletag.cmd.push(function(){ramjs.business.addGoogletagSlots(c)})}}ramjs.business.refreshAdsByTags(["interstitial"])}},shouldDisplayInterstitialSlot:function(){if(!ramjs.config.interstitial){ramjs.config.logInfo("Interstitial slot - we will not display the interstitial, if any. Missing ramjs.config.interstitial");return false}var c=true,b=ramjs.config.getCookie(ramjs.config.interstitial.displayedCookieName),a=ramjs.config.getCookie(ramjs.config.interstitial.firstTimeCookieName);if(Math.floor(a)!==1){c=false;ramjs.config.logInfo("Interstitial slot - we will not display the interstitial. First page in session. Cookie value:",a)}else{if(Math.floor(b)===1||(ramjs.config.interstitial.shouldBeDisplayed&&!ramjs.config.interstitial.shouldBeDisplayed())){c=false;ramjs.config.logInfo("Interstitial slot - we will not display the interstitial. cookieValue:",b,"- shouldDisplayInterstitialSlot: ",c)}}ramjs.config.setCookie(ramjs.config.interstitial.firstTimeCookieName,1,{path:"/",expires:ramjs.config.interstitial.firstTimeCookieTimeExpiration,domain:ramjs.config.interstitial.firstTimeCookieDomain});return c}};ramjs.prebid={init:function(a){ramjs.config.logInfo("ramjs.prebid.init: start");pbjs.que.push(function(){ramjs.prebid.setBidderSettings();pbjs.setConfig(ramjs.config.prebidConfig());pbjs.addAdUnits(a)});ramjs.config.logInfo("ramjs.prebid.init: end")},setTargetingForGPTAsync:function(a){pbjs.setTargetingForGPTAsync(a)},setBidderSettings:function(){pbjs.bidderSettings={standard:{adserverTargeting:[{key:"hb_bidder",val:function(a){return a.bidderCode}},{key:"hb_adid",val:function(a){return a.adId}},{key:"hb_pb",val:function(b){var a=b.cpm;if(a<1){return(Math.floor(a*100)/100).toFixed(2)}else{if(a<3){return(Math.floor(a*50)/50).toFixed(2)}else{if(a<5){return(Math.floor(a*20)/20).toFixed(2)}else{if(a<10){return(Math.floor(a*10)/10).toFixed(2)}else{if(a<20){return(Math.floor(a*5)/5).toFixed(2)}else{if(a<50){return(Math.floor(a*2)/2).toFixed(2)}else{if(a<80){return Math.floor(a).toFixed(2)}else{return"80.00"}}}}}}}}},{key:"hb_size",val:function(a){return a.size}},{key:"hb_format",val:function(a){return a.mediaType}}]}};pbjs.bidderSettings.aol={bidCpmAdjustment:function(a){return a*0.88}};pbjs.bidderSettings.smartadserver={bidCpmAdjustment:function(a){return a*0.88}}},requestBids:function(a,b){ramjs.config.logInfo("ramjs.prebid.requestBids:",a);pbjs.que.push(function(){pbjs.requestBids({adUnitCodes:a,bidsBackHandler:b,timeout:ramjs.config.PREBID_TIMEOUT})})},forEach:function(b,a){Object.keys(b).forEach(function(d){var c=b[d];c.bids.forEach(function(e){a(d,e)})})},_winningBids:function(){if(!ramjs.config.isDebugEnabled()){return}var f=pbjs.getAllWinningBids();var c=[];ramjs.prebid.forEach(pbjs.getBidResponses(),function(h,b){c.push({bid:b,adunit:h,adId:b.adId,bidder:b.bidder,time:b.timeToRespond,cpm:b.cpm,msg:b.statusMessage,rendered:!!f.find(function(i){return i.adId==b.adId})})});ramjs.prebid.forEach(pbjs.getNoBids&&pbjs.getNoBids()||{},function(h,b){c.push({msg:"no bid",adunit:h,adId:b.bidId,bidder:b.bidder})});if(c.length){ramjs.config.logInfo("Bid responses:");if(console.table){console.table(c)}else{for(var d=0;d<c.length;d++){ramjs.config.logInfo(c[d])}}ramjs.config.logInfo("prebid winners:");var g=pbjs.getHighestCpmBids();var c=[];for(var e=0;e<g.length;e++){var a=g[e];c.push({adunit:a.adUnitCode,adId:a.adId,bidder:a.bidder,time:a.timeToRespond,cpm:a.cpm})}if(c.length){if(console.table){console.table(c)}else{for(var d=0;d<c.length;d++){ramjs.config.logInfo(c[d])}}}else{ramjs.config.logWarn("No prebid winners")}}else{ramjs.config.logWarn("NO prebid responses")}}};ramjs.aps={_enabled:!(typeof(abp)!=="undefined"&&abp),init:function(){if(!ramjs.aps._enabled){ramjs.config.logInfo("ramjs.aps.init: aps is not enabled. apstag not initialized");return}ramjs.config.logInfo("ramjs.aps.init: start");apstag.init({pubID:ramjs.config.apsID,adServer:"googletag",bidTimeout:ramjs.config.PREBID_TIMEOUT,simplerGPT:true},function(){ramjs.config.logInfo("ramjs.aps.init: apstag initialized")});ramjs.config.logInfo("ramjs.aps.init: end")},setTargetingForGPTAsync:function(a){if(!ramjs.aps._enabled){ramjs.config.logInfo("ramjs.aps.setTargetingForGPTAsync: aps is not enabled. Won't set bids in GAM");return}apstag.setDisplayBids()},requestBids:function(a,b){if(!ramjs.aps._enabled){ramjs.config.logInfo("ramjs.aps.requestBids: aps is not enabled. Bids not requested");return}ramjs.config.logInfo("ramjs.aps.requestBids:",a);var c=ramjs.business.getGoogleSlotsFromAdCode(ramjs.business._adSlots,a)||[];apstag.fetchBids({slots:c},b)},_winningBids:function(b){if(!ramjs.config.isDebugEnabled()||!ramjs.aps._enabled){return}ramjs.config.logInfo("aps bids:");if(b.length){if(console.table){console.table(b)}else{for(var a=0;a<b.length;a++){ramjs.config.logInfo(b[a])}}}else{ramjs.config.logWarn("No aps bids")}}};ramjs.signal={_initialized:false,init:function(){if(this._initialized){ramjs.config.logInfo("Call to init signal not executed. Already initialized before.");return}if(ramjs.config.signal&&ramjs.config.signal.enabled){this._initialized=true;this._loadScript();this._setSignalTargetingInGPT();this._registerUpdateEventForSovrnReloadInPubstack()}else{ramjs.config.logWarn("ramjs.config.signal.enabled not set to true. signal is not available. Skipping...")}},_registerUpdateEventForSovrnReloadInPubstack:function(){ramjs.config.logInfo("ramjs.signal._registerUpdateEventForSovrnReload: registering event...");googletag.cmd.push(function(){ramjs.config.logInfo("ramjs.signal._registerUpdateEventForSovrnReload: event registered");googletag.pubads().addEventListener("slotRequested",function(a){pbjs.que.push(function(){if(a.slot.getSlotElementId()){for(var c in pbjs.adUnits){adUnit=pbjs.adUnits[c];if(adUnit.code===a.slot.getSlotElementId()&&adUnit.pubstack&&adUnit.pubstack.tags){for(var b in adUnit.pubstack.tags){if(adUnit.pubstack.tags[b].indexOf("sovrn-reload")===0){adUnit.pubstack.tags[b]="sovrn-reload: true"}}}}}})})})},_setSignalTargetingInGPT:function(){googletag.cmd.push(function(){if(ramjs.business._adSlots.length>0){for(var a in ramjs.business._adSlots){var b=ramjs.business._adSlots[a];if(b.hasOwnProperty("gptslot")){b.gptslot.setTargeting("sovrn-reload","false")}}ramjs.config.logInfo("ramjs.signal._setSignalTargetingInGPT: specific ad targeting set for slots:",ramjs.business._adSlots)}else{setTimeout(ramjs.signal._setSignalTargetingInGPT,50);ramjs.config.logInfo("ramjs.signal._setSignalTargetingInGPT: couldn't set specific ad targeting yet. No slots:",ramjs.business._adSlots,"Retrying...")}})},_loadScript:function(){if(!ramjs.business._abp&&ramjs.config.signal&&ramjs.config.signal.src){window.didomiOnReady=window.didomiOnReady||[];window.didomiOnReady.push(function(a){if(a.isConsentRequired()){a.getObservableOnUserConsentStatusForVendor(13).filter(function(b){return b===true}).first().subscribe(function(b){ramjs.signal._loadSignalTagScript()})}else{ramjs.signal._loadSignalTagScript()}})}else{ramjs.config.logInfo("ramjs.signal._loadScript: Signal not set. Using AdBlocker")}},_loadSignalTagScript:function(){ramjs.config.logInfo("ramjs._loadSignalTagScript: loading Signal script...");var a=document.createElement("script");a.type="text/javascript";a.src=ramjs.config.signal.src;a.defer=true;document.head.appendChild(a)}};ramjs.pubstack={_initialized:false,init:function(){if(ramjs.pubstack._initialized){ramjs.config.logInfo("Call to init pubstack not executed. Already initialized before.");return}this._initialized=true;if(ramjs.config.pubstack&&ramjs.config.pubstack.enabled){this._loadScript()}else{ramjs.config.logWarn("ramjs.config.pubstack.enabled not set to true. pubstack is not available. Skipping...")}},_loadScript:function(){if(typeof(adblock)!=="undefined"){if(ramjs.business._shouldDisplayAds()){ramjs.config.logInfo("ramjs.pubstack._loadScript: loading pubstack script...");var b=ramjs.config.pubstack.id;if(ramjs.business._abp&&ramjs.config.pubstack.abp_id){b=ramjs.config.pubstack.abp_id}var a=document.createElement("script");a.type="text/javascript";a.src=ramjs.config.pubstack.url+b;a.defer=true;document.head.appendChild(a)}else{if(typeof(adblock)!="undefined"){setTimeout(function(){ramjs.pubstack._loadScript()},500)}}}},addAdUnitPath:function(c,a){if(!ramjs.config.pubstack||!ramjs.config.pubstack.enabled){return a}var b=c.name;if(c.hasOwnProperty("slotname")){b=c.slotname}a.pubstack={adUnitName:c.name,adUnitPath:"/"+ramjs.config.siteID+"/"+b+"?abtest="+ramjs.config.GA_VARIATION,tags:["abtest:"+ramjs.config.GA_VARIATION,"up_recovery:"+(ramjs.business._abp?"1":"0"),"sovrn-reload: false"]};return a}};